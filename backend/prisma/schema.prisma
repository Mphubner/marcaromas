generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id            Int      @id @default(autoincrement())
  name          String
  email         String   @unique
  password      String?
  isAdmin       Boolean  @default(false)
  createdAt     DateTime @default(now())
  googleEmail   String?
  googleId      String?  @unique
  total_credits Float?   @default(0)

  // Customer Management Fields
  phone       String?
  cpf         String?   @unique
  birthdate   DateTime?
  address     Json? // {street, number, complement, city, state, zip}
  status      String    @default("active") // active, inactive, blocked
  lastLoginAt DateTime?
  notes       String? // Admin notes


  carts         Cart[]
  orders        Order[]
  scentProfile  ScentProfile?
  subscriptions Subscription[]
  contents      Content[]
  contentVersions ContentVersion[]
  addresses     Address[]
  userAchievements UserAchievement[]
  wishlists     Wishlist[]
  notificationPreferences NotificationPreference?
}

model Address {
  id         Int      @id @default(autoincrement())
  userId     Int
  label      String? // "Casa", "Trabalho", etc
  zipCode    String
  street     String
  number     String
  complement String?
  neighborhood String
  city       String
  state      String
  country    String  @default("Brasil")
  isDefault  Boolean @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Product {
  id                String           @id @default(cuid())
  name              String
  slug              String           @unique
  description       String?
  price             Float
  category          String?
  createdAt         DateTime         @default(now())
  aroma_family      String?
  aroma_notes       String[]
  burn_time         String?
  compare_at_price  Float?
  images            String[]
  ingredients       String[]
  is_available      Boolean          @default(true)
  is_featured       Boolean          @default(false)
  short_description String?
  size              String?
  stock_quantity    Int              @default(0)
  tags              String[]
  updatedAt         DateTime         @updatedAt
  barcode           String?
  height            Float?
  inventory_policy  String?
  length            Float?
  product_type      String?
  seo_description   String?
  seo_title         String?
  sku               String?
  vendor            String?
  weight            Float?
  width             Float?
  cartItems         CartItem[]
  orderItems        OrderItem[]
  variants          ProductVariant[]
  wishlists         Wishlist[]

  @@index([category])
  @@index([is_featured])
  @@index([is_available])
  @@index([price])
  @@index([name])
}

model ProductVariant {
  id            String  @id @default(cuid())
  productId     String
  variant_name  String
  price         Float
  inventory_qty Int     @default(0)
  product       Product @relation(fields: [productId], references: [id])
}

model OrderItem {
  id        Int     @id @default(autoincrement())
  orderId   Int
  productId String
  quantity  Int
  price     Float
  order     Order   @relation(fields: [orderId], references: [id])
  product   Product @relation(fields: [productId], references: [id])
}

model Order {
  id                    Int            @id @default(autoincrement())
  userId                Int?
  total                 Float
  status                String         @default("pending")
  mpPreferenceId        String?
  createdAt             DateTime       @default(now())
  mpPaymentId           String?
  shippingAddress       Json?
  tracking_code         String?
  actualDeliveryDate    DateTime?
  adminNotes            String?
  billingAddress        Json?
  canceledAt            DateTime?
  cancellationReason    String?
  carrier               String?
  channel               String         @default("website")
  deliveredAt           DateTime?
  deliveryAddress       Json?
  discount              Float          @default(0)
  estimatedDeliveryDate DateTime?
  labelUrl              String?
  notes                 String?
  paidAt                DateTime?
  paymentMethod         String?
  paymentProof          String?
  paymentStatus         String?
  refundAmount          Float?
  refundedAt            DateTime?
  shipDate              DateTime?
  shippedAt             DateTime?
  shippingCost          Float          @default(0)
  shippingMethod        String?
  subtotal              Float
  tax                   Float          @default(0)
  trackingUrl           String?
  updatedAt             DateTime       @updatedAt
  orderNumber           String         @unique
  couponCode            String?
  paymentDetails        Json?
  labelGeneratedAt      DateTime?
  customerNotes         String?
  confirmedAt           DateTime?
  user                  User?          @relation(fields: [userId], references: [id])
  history               OrderHistory[]
  items                 OrderItem[]
  referralConversions   ReferralConversion[]

  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@index([orderNumber])
}

model OrderHistory {
  id          Int      @id @default(autoincrement())
  orderId     Int
  eventType   String
  eventStatus String
  description String?
  metadata    Json?
  createdBy   Int?
  createdAt   DateTime @default(now())
  order       Order    @relation(fields: [orderId], references: [id])
}

model Subscription {
  id                  Int                   @id @default(autoincrement())
  userId              Int
  planId              String
  mpSubscriptionId    String?
  status              String                @default("active")
  startedAt           DateTime              @default(now())
  nextBilling         DateTime?
  preferences         Json?
  shippingAddress     Json?
  billingAddress      Json?
  canceledAt          DateTime?
  cancellationReason  String?
  createdAt           DateTime              @default(now())
  deliveryAddress     Json?
  deliveryCount       Int                   @default(0)
  failedPaymentsCount Int                   @default(0)
  lastDeliveryDate    DateTime?
  lastPaymentDate     DateTime?
  lastPaymentStatus   String?
  pauseCount          Int                   @default(0)
  pausedAt            DateTime?
  paymentMethod       String?
  renewalDate         DateTime?
  updatedAt           DateTime              @updatedAt
  plan                Plan                  @relation(fields: [planId], references: [id])
  user                User                  @relation(fields: [userId], references: [id])
  history             SubscriptionHistory[]
  referralConversions ReferralConversion[]
}

model SubscriptionHistory {
  id             Int          @id @default(autoincrement())
  subscriptionId Int
  eventType      String
  eventStatus    String
  description    String?
  metadata       Json?
  createdAt      DateTime     @default(now())
  subscription   Subscription @relation(fields: [subscriptionId], references: [id])
}

model Config {
  id    Int    @id @default(autoincrement())
  key   String @unique
  value String
}

model Cart {
  id        Int        @id @default(autoincrement())
  userId    Int?
  createdAt DateTime   @default(now())
  user      User?      @relation(fields: [userId], references: [id])
  items     CartItem[]
}

model CartItem {
  id        Int      @id @default(autoincrement())
  cartId    Int
  productId String?
  name      String?
  quantity  Int      @default(1)
  price     Float?
  cart      Cart     @relation(fields: [cartId], references: [id])
  product   Product? @relation(fields: [productId], references: [id])
}

model Box {
  id                        Int      @id @default(autoincrement())
  month                     String   @unique
  theme                     String
  description               String?
  image_url                 String?
  candle_name               String?
  aroma_notes               String[]
  spotify_playlist          String?
  ritual_tips               String?
  is_published              Boolean  @default(false)
  createdAt                 DateTime @default(now())
  images                    String[]
  benefits                  String[] @default([])
  category                  String   @default("box")
  is_available_for_purchase Boolean  @default(true)
  items_included            String[] @default([])
  original_price            Float?
  price                     Float    @default(99.90)
  stock_quantity            Int?
  total_items_value         Float?
}

model Banner {
  id        String   @id @default(cuid())
  title     String
  images    String[]
  link      String?
  is_active Boolean  @default(true)
  createdAt DateTime @default(now())
}

model SiteSettings {
  id        Int      @id @default(autoincrement())
  section   String   @unique
  content   Json
  createdAt DateTime @default(now())
}

model Plan {
  id                  String         @id @default(cuid())
  name                String
  description         String?
  price               Float
  discount_percentage Float?
  items_included      String[]
  benefits            String[]
  is_active           Boolean        @default(true)
  createdAt           DateTime       @default(now())
  images              String[]
  seo_description     String?
  seo_title           String?
  long_description    String?
  short_description   String?
  total_value         Float?
  subscriptions       Subscription[]
}

model Contact {
  id        Int      @id @default(autoincrement())
  name      String
  email     String
  phone     String?
  subject   String
  message   String
  status    String   @default("pending")
  createdAt DateTime @default(now())
}

model BlogPost {
  id              String    @id @default(cuid())
  title           String
  slug            String    @unique
  content         String
  excerpt         String?
  cover_image     String?
  author_name     String?
  category        String?
  tags            String[]
  is_published    Boolean   @default(false)
  publish_date    DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  images          String[]
  seo_description String?
  seo_title       String?
}

model Shipment {
  id             String    @id @default(cuid())
  userEmail      String
  orderId        Int?
  subscriptionId Int?
  box_id         String?
  shipped_date   DateTime?
  tracking_code  String?
  status         String
  createdAt      DateTime  @default(now())
}

model Achievement {
  id             String   @id @default(cuid())
  name           String
  description    String
  icon           String   // Emoji or icon name
  category       String   // COMPRAS, ASSINATURA, COMUNIDADE, INDICACOES, COLECAO
  tier           String   // BRONZE, SILVER, GOLD, PLATINUM, DIAMOND
  points         Int
  requirementType String  // purchase_count, subscription_months, review_count, referral_count, product_collection
  requirementTarget Int   // Target number to achieve (e.g., 5 purchases)
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  // Relations
  userAchievements UserAchievement[]
  
  @@index([category])
  @@index([tier])
}

model UserAchievement {
  id             String   @id @default(cuid())
  userId         Int
  achievementId  String
  progress       Int      @default(0) // Current progress
  unlocked       Boolean  @default(false)
  unlockedAt     DateTime?
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  // Relations
  user           User       @relation(fields: [userId], references: [id])
  achievement    Achievement @relation(fields: [achievementId], references: [id])
  
  @@unique([userId, achievementId])
  @@index([userId])
  @@index([unlocked])
  @@index([userId, unlocked])
}

model AchievementReward {
  id             String   @id @default(cuid())
  name           String
  description    String
  type           String   // DISCOUNT, CREDIT, FREE_SHIPPING, EXCLUSIVE_CONTENT
  value          Float    // Discount percentage or credit amount
  requiredPoints Int
  isActive       Boolean  @default(true)
  code           String?  // Generated code for discount coupons
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  @@index([isActive])
  @@index([requiredPoints])
}


model ScentHistory {
  id           String   @id @default(cuid())
  userEmail    String
  product_name String
  aroma_family String
  rating       Int?
  liked        Boolean?
  createdAt    DateTime @default(now())
}

model Review {
  id                   String    @id @default(cuid())
  userEmail            String
  userName             String? // Display name
  productId            String?
  rating               Int
  title                String?
  comment              String
  images               String[]  @default([]) // Review photos
  is_verified_purchase Boolean   @default(false)
  is_approved          Boolean   @default(false)
  helpful_count        Int       @default(0)
  adminResponse        String? // Store response
  respondedAt          DateTime?
  respondedBy          String? // Admin email
  reported             Boolean   @default(false)
  reportReason         String?
  reportedAt           DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
}

model Coupon {
  id                String    @id @default(cuid())
  code              String    @unique
  type              String // percent, fixed, free_shipping
  amount            Float
  description       String? // Admin notes/description
  min_purchase      Float?
  maxDiscountAmount Float? // Max discount for percentage coupons
  applies_to        String    @default("all")
  specific_ids      String[]  @default([])
  categories        String[]  @default([]) // Which categories
  userSpecific      String[]  @default([]) // Specific user emails
  usage_limit       Int?
  times_used        Int       @default(0)
  is_active         Boolean   @default(true)
  startDate         DateTime? // When coupon becomes active
  expiry_date       DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}

model Newsletter {
  id        String   @id @default(cuid())
  email     String   @unique
  full_name String?
  status    String   @default("subscribed")
  source    String?
  createdAt DateTime @default(now())
}

model Wishlist {
  id              String   @id @default(cuid())
  userId          Int
  productId       String
  addedAt         DateTime @default(now())
  notifyOnSale    Boolean  @default(true)
  notifyOnStock   Boolean  @default(true)
  
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  product         Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@unique([userId, productId])
  @@index([userId])
  @@index([productId])
}

model WishlistNotification {
  id          String   @id @default(cuid())
  userId      Int
  productId   String
  type        String   // SALE, BACK_IN_STOCK, PRICE_DROP
  sent        Boolean  @default(false)
  sentAt      DateTime?
  metadata    Json?    // Store price info, discount %, etc
  createdAt   DateTime @default(now())
  
  @@index([userId])
  @@index([productId])
  @@index([sent])
}

model Referral {
  id               String    @id @default(cuid())
  referrer_email   String
  referrerName     String? // Display name
  referred_email   String?
  referredName     String? // Referred person name
  status           String    @default("pending") // pending, completed, rewarded
  reward_amount    Float?
  referral_code    String    @unique
  completedAt      DateTime? // When referral was completed
  rewardPaid       Boolean   @default(false)
  paidAt           DateTime?
  notes            String? // Admin notes
  convertedOrderId Int? // First order of referred user
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
}

model ExclusiveContent {
  id                String    @id @default(cuid())
  title             String
  type              String
  description       String?
  content           String
  cover_image       String?
  required_plan_ids String[]
  is_published      Boolean   @default(false)
  publish_date      DateTime?
  createdAt         DateTime  @default(now())
}

model Notification {
  id        String   @id @default(cuid())
  userEmail String
  title     String
  message   String
  type      String   // ORDER, SUBSCRIPTION, REFERRAL, ACHIEVEMENT, PROMOTION, CONTENT, SYSTEM
  category  String?  // Same as type, for filtering
  channel   String   @default("IN_APP") // IN_APP, EMAIL, PUSH
  link      String?
  data      Json?    // Dynamic data for templates
  is_read   Boolean  @default(false)
  createdAt DateTime @default(now())
  
  @@index([userEmail])
  @@index([is_read])
  @@index([type])
}

model NotificationPreference {
  id        String   @id @default(cuid())
  userId    Int      @unique
  email     Boolean  @default(true)
  push      Boolean  @default(true)
  in_app    Boolean  @default(true)
  
  // Categories
  orders        Boolean @default(true)
  subscriptions Boolean @default(true)
  referrals     Boolean @default(true)
  achievements  Boolean @default(true)
  promotions    Boolean @default(true)
  content       Boolean @default(true)
  
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model NotificationTemplate {
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique // e.g., "order-confirmed"
  subject     String
  content     String   // HTML or Markdown
  type        String   // EMAIL, IN_APP
  variables   String[] // List of available variables e.g. ["userName", "orderId"]
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ScentProfile {
  id                   String   @id @default(cuid())
  userId               Int      @unique
  aroma_families       String[]
  intensity_preference String?
  favorite_notes       String[]
  occasions            String[]
  dislikes             String[]
  mood_preference      String?
  user                 User     @relation(fields: [userId], references: [id])
}

// ============================================
// REFERRAL SYSTEM MODELS
// ============================================

model ReferralProgram {
  id                     String             @id @default(cuid())
  name                   String
  type                   String // FIXED, PERCENTAGE, RECURRING_PERCENTAGE, HYBRID, TIERED
  is_active              Boolean            @default(true)
  // Reward settings
  fixed_amount           Float?
  percentage             Float?
  recurring_percentage   Float?
  max_amount             Float?
  // Trigger rules
  trigger_event          String // SIGNUP, FIRST_PURCHASE, PURCHASE, SUBSCRIPTION, SUBSCRIPTION_PAYMENT
  min_purchase_amount    Float?
  // Recurrence
  is_recurring           Boolean            @default(false)
  recurring_duration     String? // LIFETIME, FIRST_3_MONTHS, FIRST_YEAR, CUSTOM
  recurring_months       Int?
  // Tiers (JSON for flexibility)
  tier_config            Json?
  // Audit
  created_at             DateTime           @default(now())
  updated_at             DateTime           @updatedAt
  created_by_id          Int?
  referralCodes          ReferralCode[]
  referralConversions    ReferralConversion[]
}

model ReferralCode {
  id             String               @id @default(cuid())
  user_id        Int
  code           String               @unique
  program_id     String
  // Metrics
  clicks         Int                  @default(0)
  signups        Int                  @default(0)
  conversions    Int                  @default(0)
  total_earned   Float                @default(0)
  // Status
  is_active      Boolean              @default(true)
  expires_at     DateTime?
  created_at     DateTime             @default(now())
  // Relations
  program        ReferralProgram      @relation(fields: [program_id], references: [id])
  clicks_logged  ReferralClick[]
  conversions_logged ReferralConversion[]
  
  @@index([user_id])
  @@index([code])
}

model ReferralClick {
  id                 String        @id @default(cuid())
  referral_code_id   String
  // Visitor data
  ip_address         String?
  user_agent         String?
  source_url         String?
  landing_url        String?
  // Geolocation
  country            String?
  city               String?
  // Social Media
  is_social_media    Boolean       @default(false)
  social_platform    String? // INSTAGRAM, FACEBOOK, WHATSAPP, TELEGRAM
  // Conversion
  converted          Boolean       @default(false)
  converted_user_id  Int?
  converted_at       DateTime?
  created_at         DateTime      @default(now())
  // Relations
  referralCode       ReferralCode  @relation(fields: [referral_code_id], references: [id])
  
  @@index([referral_code_id])
  @@index([converted])
}

model ReferralConversion {
  id                    String           @id @default(cuid())
  referral_code_id      String
  program_id            String
  referrer_user_id      Int // Who referred
  referred_user_id      Int // Who was referred
  // Conversion type
  conversion_type       String // SIGNUP, PURCHASE, SUBSCRIPTION
  // Transaction data
  order_id              Int?
  subscription_id       Int?
  transaction_amount    Float?
  // Reward
  reward_amount         Float
  reward_status         String           @default("PENDING") // PENDING, APPROVED, PAID, CANCELLED
  // Recurrence
  is_recurring          Boolean          @default(false)
  parent_conversion_id  String?
  // Timestamps
  created_at            DateTime         @default(now())
  paid_at               DateTime?
  // Relations
  referralCode          ReferralCode     @relation(fields: [referral_code_id], references: [id])
  program               ReferralProgram  @relation(fields: [program_id], references: [id])
  order                 Order?           @relation(fields: [order_id], references: [id])
  subscription          Subscription?    @relation(fields: [subscription_id], references: [id])
  parentConversion      ReferralConversion? @relation("RecurringConversions", fields: [parent_conversion_id], references: [id])
  childConversions      ReferralConversion[] @relation("RecurringConversions")
  
  @@index([referrer_user_id])
  @@index([referred_user_id])
  @@index([reward_status])
}

model SocialMediaMention {
  id                  String    @id @default(cuid())
  user_id             Int
  // Platform
  platform            String // INSTAGRAM, FACEBOOK, TWITTER, TIKTOK
  platform_post_id    String?
  // Content
  mention_type        String // POST, STORY, COMMENT, TAG
  content_url         String?
  caption             String?
  // Engagement
  likes               Int       @default(0)
  comments            Int       @default(0)
  shares              Int       @default(0)
  reach               Int       @default(0)
  // Reward
  reward_amount       Float?
  reward_status       String    @default("PENDING") // PENDING, APPROVED, PAID
  // Timestamps
  created_at          DateTime  @default(now())
  verified_at         DateTime?
  
  @@index([user_id])
  @@index([platform])
}

model ReferralPayout {
  id              String    @id @default(cuid())
  user_id         Int
  // Amount
  amount          Float
  conversion_ids  String[] // Array of conversion IDs
  // Payout method
  payout_method   String // PIX, BANK_TRANSFER, STORE_CREDIT, DISCOUNT_COUPON
  pix_key         String?
  // Status
  status          String    @default("PENDING") // PENDING, PROCESSING, COMPLETED, FAILED
  // Audit
  requested_at    DateTime  @default(now())
  processed_at    DateTime?
  completed_at    DateTime?
  notes           String?
  
  @@index([user_id])
  @@index([status])
}

// ============================================
// CMS SYSTEM MODELS
// ============================================

model Content {
  id                String         @id @default(cuid())
  
  // Basic Info
  title             String
  slug              String         @unique
  excerpt           String?
  cover_image       String?
  
  // Content Type
  type              String         // BLOG_POST, EXCLUSIVE_CONTENT
  
  // Publishing
  status            String         @default("DRAFT") // DRAFT, PUBLISHED, ARCHIVED
  publish_date      DateTime?
  published_by_id   Int?
  
  // Categorization
  category          String?        // aromatherapy, self_care, wellness, behind_scenes
  tags              String[]
  
  // Access Control (for exclusive content)
  required_plan_ids String[]       // Empty = public, filled = exclusive
  
  // SEO
  seo_title         String?
  seo_description   String?
  seo_keywords      String[]
  
  // Reading Stats
  read_time_minutes Int?
  views             Int            @default(0)


  
  // Relations
  blocks            ContentBlock[]
  versions          ContentVersion[]
  author            User?          @relation(fields: [published_by_id], references: [id])
  
  // Audit
  created_at        DateTime       @default(now())
  updated_at        DateTime       @updatedAt
  
  // Performance Indexes
  @@index([slug])
  @@index([type, status, publish_date])
  @@index([category, status])
  @@index([type, category, status])
  @@index([status, publish_date])
  
  @@index([status])
  @@index([type])
  @@index([publish_date])
  @@index([category])
}

model ContentBlock {
  id          String   @id @default(cuid())
  content_id  String
  
  // Block ordering
  order       Int
  
  // Block type
  type        String   // TEXT, HEADING, IMAGE, YOUTUBE, SPOTIFY, GALLERY, QUOTE, DIVIDER, CODE
  
  // Polymorphic data (JSON for flexibility)
  data        Json
  
  // Visibility
  is_visible  Boolean  @default(true)
  
  // Relations
  content     Content  @relation(fields: [content_id], references: [id], onDelete: Cascade)
  
  // Audit
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  
  @@index([content_id])
  @@index([order])
}

model ContentVersion {
  id         String   @id @default(cuid())
  content_id String
  version    Int
  
  // Snapshot of content at this version
  title      String
  excerpt    String?
  data       Json     // Full content + blocks snapshot
  
  // Change tracking
  change_description String?
  created_by         Int
  created_at         DateTime @default(now())
  
  // Relations
  content    Content  @relation(fields: [content_id], references: [id], onDelete: Cascade)
  author     User     @relation(fields: [created_by], references: [id])
  
  @@unique([content_id, version])
  @@index([content_id])
  @@index([created_at])
}

// ============================================
// GIFT SUBSCRIPTIONS
// ============================================

model Gift {
  id                  Int      @id @default(autoincrement())
  
  // Plan details
  planId              String
  duration            Int      // Number of months to gift
  
  // Giver information
  giverName           String
  giverEmail          String
  giverPhone          String?
  giverCPF            String?
  
  // Recipient information
  recipientName       String
  recipientEmail      String
  recipientPhone      String
  recipientAddress    Json     // Full address object
  
  // Gift personalization
  message             String?
  scheduledDate       DateTime? // When to send notification
  sendImmediate       Boolean  @default(true)
  
  // Additional products
  extras              Json?    // [{productId, quantity, product}]
  
  // Pricing
  subtotal            Float
  discount            Float    @default(0)
  total               Float
  
  // Payment
  paymentMethod       String?
  installments        Int      @default(1)
  mpPreferenceId      String?  // Mercado Pago preference ID
  mpPaymentId         String?  // Mercado Pago payment ID
  paymentStatus       String   @default("pending") // pending, paid, failed
  paymentDetails      Json?
  
  // Status
  status              String   @default("pending") // pending, paid, notified, delivered, cancelled
  notifiedAt          DateTime? // When recipient was notified
  deliveredAt         DateTime? // When first delivery was made
  cancelledAt         DateTime?
  cancellationReason  String?
  
  // Audit
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  @@index([giverEmail])
  @@index([recipientEmail])
  @@index([status])
  @@index([paymentStatus])
}

model SystemLog {
  id        String   @id @default(cuid())
  level     String   // INFO, WARN, ERROR
  module    String   // AUTH, ORDER, PAYMENT, SYSTEM, etc.
  message   String
  metadata  Json?
  createdAt DateTime @default(now())

  @@index([level])
  @@index([module])
  @@index([createdAt])
}

model WebhookLog {
  id        String   @id @default(cuid())
  provider  String   // STRIPE, MERCADOPAGO, ETC
  event     String
  payload   Json?
  status    String   // SUCCESS, FAILED
  error     String?
  createdAt DateTime @default(now())

  @@index([provider])
  @@index([status])
  @@index([createdAt])
}
